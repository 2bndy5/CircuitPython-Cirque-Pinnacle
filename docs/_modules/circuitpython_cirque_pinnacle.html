

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>circuitpython_cirque_pinnacle &mdash; Circuitpython Cirque Pinnacle Library 1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/darkness.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Circuitpython Cirque Pinnacle Library
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Introduction</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Simple Test</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html#usb-mouse-example">USB Mouse example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html#anymeas-mode-example">AnyMeas mode example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html#context-manager-example">Context Manager example</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api.html">PinnacleTouch API</a></li>
</ul>
<p class="caption"><span class="caption-text">Related Products</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://www.mouser.com/Search/Refine?Ntk=P_MarCom&amp;Ntt=118816186">Cirque Glidepoint circle trackpads</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.mouser.com/Connectors/FFC-FPC/FFC-FPC-Jumper-Cables/_/N-axro3?P=1yc8ojpZ1z0wxjx">12-pin FPC cable (0.5mm pitch)</a></li>
</ul>
<p class="caption"><span class="caption-text">Other Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/2bndy5/CircuitPython_Pinnacle_1ca027/releases/latest">Download</a></li>
<li class="toctree-l1"><a class="reference external" href="https://circuitpython.readthedocs.io">CircuitPython Reference Documentation</a></li>
<li class="toctree-l1"><a class="reference external" href="https://forums.adafruit.com/viewforum.php?f=60">CircuitPython Support Forum</a></li>
<li class="toctree-l1"><a class="reference external" href="https://adafru.it/discord">Discord Chat</a></li>
<li class="toctree-l1"><a class="reference external" href="https://learn.adafruit.com">Adafruit Learning System</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blog.adafruit.com">Adafruit Blog</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.adafruit.com">Adafruit Store</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Circuitpython Cirque Pinnacle Library</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>circuitpython_cirque_pinnacle</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for circuitpython_cirque_pinnacle</h1><div class="highlight"><pre>
<span></span><span class="c1"># The MIT License (MIT)</span>
<span class="c1">#</span>
<span class="c1"># Copyright (c) 2020 Brendan Doherty</span>
<span class="c1">#</span>
<span class="c1"># Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="c1"># of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="c1"># in the Software without restriction, including without limitation the rights</span>
<span class="c1"># to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="c1"># copies of the Software, and to permit persons to whom the Software is</span>
<span class="c1"># furnished to do so, subject to the following conditions:</span>
<span class="c1">#</span>
<span class="c1"># The above copyright notice and this permission notice shall be included in</span>
<span class="c1"># all copies or substantial portions of the Software.</span>
<span class="c1">#</span>
<span class="c1"># THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="c1"># IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="c1"># FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="c1"># AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="c1"># LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="c1"># OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="c1"># THE SOFTWARE.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">PinnacleTouch API</span>
<span class="sd">=================</span>

<span class="sd">A driver class for the Cirque Pinnacle ASIC on the Cirque capacitve touch</span>
<span class="sd">based circular trackpads.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.0.0-auto.0&quot;</span>
<span class="n">__repo__</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/2bndy5/CircuitPython_Cirque_Pinnacle.git&quot;</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">from</span> <span class="nn">adafruit_bus_device.spi_device</span> <span class="k">import</span> <span class="n">SPIDevice</span>
<span class="kn">from</span> <span class="nn">adafruit_bus_device.i2c_device</span> <span class="k">import</span> <span class="n">I2CDevice</span>

<span class="c1"># internal registers</span>
<span class="c1"># pylint: disable=bad-whitespace,too-few-public-methods</span>
<span class="n">PINNACLE_STATUS</span>           <span class="o">=</span> <span class="mh">0x02</span>  <span class="c1"># Contains status flags about the state of Pinnacle</span>
<span class="n">PINNACLE_SYS_CONFIG</span>       <span class="o">=</span> <span class="mh">0x03</span>  <span class="c1"># Contains system operation and configuration bits</span>
<span class="n">PINNACLE_FEED_CONFIG1</span>     <span class="o">=</span> <span class="mh">0x04</span>  <span class="c1"># Contains feed operation and configuration bits</span>
<span class="n">PINNACLE_FEED_CONFIG2</span>     <span class="o">=</span> <span class="mh">0x05</span>  <span class="c1"># Contains feed operation and configuration bits</span>
<span class="n">PINNACLE_CALIBRATE_CONFIG</span> <span class="o">=</span> <span class="mh">0x07</span>  <span class="c1"># Contains calibration configuration bits</span>
<span class="n">PINNACLE_SAMPLE_RATE</span>      <span class="o">=</span> <span class="mh">0x09</span>  <span class="c1"># Number of samples generated per second</span>
<span class="n">PINNACLE_Z_IDLE</span>           <span class="o">=</span> <span class="mh">0x0A</span>  <span class="c1"># Number of Z=0 packets sent when Z goes from &gt;0 to 0</span>
<span class="n">PINNACLE_PACKET_BYTE_0</span>    <span class="o">=</span> <span class="mh">0x12</span>  <span class="c1"># trackpad Data</span>
<span class="n">PINNACLE_ERA_VALUE</span>        <span class="o">=</span> <span class="mh">0x1B</span>  <span class="c1"># Value for extended register access</span>
<span class="n">PINNACLE_ERA_ADDR_HIGH</span>    <span class="o">=</span> <span class="mh">0x1C</span>  <span class="c1"># High byte of 16 bit extended register address</span>
<span class="n">PINNACLE_ERA_ADDR_LOW</span>     <span class="o">=</span> <span class="mh">0x1D</span>  <span class="c1"># Low byte of 16 bit extended register address</span>
<span class="n">PINNACLE_ERA_CTRL</span>         <span class="o">=</span> <span class="mh">0x1E</span>  <span class="c1"># Control of extended register access</span>

<span class="c1"># constants used for bitwise configuration</span>
<div class="viewcode-block" id="DataModes"><a class="viewcode-back" href="../api.html#circuitpython_cirque_pinnacle.DataModes">[docs]</a><span class="k">class</span> <span class="nc">DataModes</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Allowed symbols for configuring the Pinanacle ASIC&#39;s data</span>
<span class="sd">    reporting/measurements.&quot;&quot;&quot;</span>
    <span class="n">RELATIVE</span> <span class="o">=</span> <span class="mh">0x00</span>  <span class="c1">#: Alias symbol for specifying Relative mode (AKA Mouse mode).</span>
    <span class="n">ANYMEAS</span>  <span class="o">=</span> <span class="mh">0x01</span>  <span class="c1">#: Alias symbol for specifying &quot;AnyMeas&quot; mode (raw ADC measurement)</span>
    <span class="n">ABSOLUTE</span> <span class="o">=</span> <span class="mh">0x02</span>  <span class="c1">#: Alias symbol for specifying Absolute mode (axis positions)</span></div>

<div class="viewcode-block" id="AnyMeasGain"><a class="viewcode-back" href="../api.html#circuitpython_cirque_pinnacle.AnyMeasGain">[docs]</a><span class="k">class</span> <span class="nc">AnyMeasGain</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Allowed ADC gain configurations of AnyMeas mode. The percentages defined here are</span>
<span class="sd">    approximate values.&quot;&quot;&quot;</span>
    <span class="n">GAIN_100</span> <span class="o">=</span> <span class="mh">0xC0</span>  <span class="c1">#: around 100% gain</span>
    <span class="n">GAIN_133</span> <span class="o">=</span> <span class="mh">0x80</span>  <span class="c1">#: around 133% gain</span>
    <span class="n">GAIN_166</span> <span class="o">=</span> <span class="mh">0x40</span>  <span class="c1">#: around 166% gain</span>
    <span class="n">GAIN_200</span> <span class="o">=</span> <span class="mh">0x00</span>  <span class="c1">#: around 200% gain</span></div>

<div class="viewcode-block" id="AnyMeasFreq"><a class="viewcode-back" href="../api.html#circuitpython_cirque_pinnacle.AnyMeasFreq">[docs]</a><span class="k">class</span> <span class="nc">AnyMeasFreq</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Allowed frequency configurations of AnyMeas mode. The frequencies defined here are</span>
<span class="sd">    approximated based on an aperture width of 500 nanoseconds. If the ``aperture_width``</span>
<span class="sd">    parameter to `anymeas_mode_config()` specified is less than 500 nanoseconds, then the</span>
<span class="sd">    frequency will be larger than what is described here (&amp; vice versa).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">FREQ_0</span> <span class="o">=</span> <span class="mh">0x02</span>  <span class="c1">#: frequency around 500,000Hz</span>
    <span class="n">FREQ_1</span> <span class="o">=</span> <span class="mh">0x03</span>  <span class="c1">#: frequency around 444,444Hz</span>
    <span class="n">FREQ_2</span> <span class="o">=</span> <span class="mh">0x04</span>  <span class="c1">#: frequency around 400,000Hz</span>
    <span class="n">FREQ_3</span> <span class="o">=</span> <span class="mh">0x05</span>  <span class="c1">#: frequency around 363,636Hz</span>
    <span class="n">FREQ_4</span> <span class="o">=</span> <span class="mh">0x06</span>  <span class="c1">#: frequency around 333,333Hz</span>
    <span class="n">FREQ_5</span> <span class="o">=</span> <span class="mh">0x07</span>  <span class="c1">#: frequency around 307,692Hz</span>
    <span class="n">FREQ_6</span> <span class="o">=</span> <span class="mh">0x09</span>  <span class="c1">#: frequency around 267,000Hz</span>
    <span class="n">FREQ_7</span> <span class="o">=</span> <span class="mh">0x0B</span>  <span class="c1">#: frequency around 235,000Hz</span></div>

<div class="viewcode-block" id="AnyMeasMux"><a class="viewcode-back" href="../api.html#circuitpython_cirque_pinnacle.AnyMeasMux">[docs]</a><span class="k">class</span> <span class="nc">AnyMeasMux</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Allowed muxing gate polarity and reference capacitor configurations of AnyMeas mode.</span>
<span class="sd">    Combining these values (with ``+`` operator) is allowed.</span>

<span class="sd">    .. note:: The sign of the measurements taken in AnyMeas mode is inverted depending on which</span>
<span class="sd">        muxing gate is specified (when specifying an individual gate polarity).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">MUX_REF1</span> <span class="o">=</span> <span class="mh">0x10</span>  <span class="c1">#: enables a builtin capacitor (~0.5pF). See note in `measure_adc()`</span>
    <span class="n">MUX_REF0</span> <span class="o">=</span> <span class="mh">0x08</span>  <span class="c1">#: enables a builtin capacitor (~0.25pF). See note in `measure_adc()`</span>
    <span class="n">MUX_PNP</span>  <span class="o">=</span> <span class="mh">0x04</span>  <span class="c1">#: enable PNP sense line</span>
    <span class="n">MUX_NPN</span>  <span class="o">=</span> <span class="mh">0x01</span>  <span class="c1">#: enable NPN sense line</span></div>

<div class="viewcode-block" id="AnyMeasCrtl"><a class="viewcode-back" href="../api.html#circuitpython_cirque_pinnacle.AnyMeasCrtl">[docs]</a><span class="k">class</span> <span class="nc">AnyMeasCrtl</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;These constants control the number of measurements performed on a single call to</span>
<span class="sd">    `measure_adc()`. The number of measurements can range [0, 63].&quot;&quot;&quot;</span>
    <span class="n">CRTL_REPEAT</span> <span class="o">=</span> <span class="mh">0x80</span>  <span class="c1">#: required for more than 1 measurement</span>
    <span class="n">CRTL_PWR_IDLE</span> <span class="o">=</span> <span class="mh">0x40</span>  <span class="c1">#: triggers low power mode (sleep) after completing measurements</span></div>
<span class="c1"># pylint: enable=bad-whitespace,too-few-public-methods</span>

<div class="viewcode-block" id="PinnacleTouch"><a class="viewcode-back" href="../api.html#circuitpython_cirque_pinnacle.PinnacleTouch">[docs]</a><span class="k">class</span> <span class="nc">PinnacleTouch</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The abstract base class for driving the Pinnacle ASIC.</span>

<span class="sd">    :param ~microcontroller.Pin dr_pin: The input pin connected to the Pinnacle ASIC&#39;s &quot;Data</span>
<span class="sd">        Ready&quot; pin. If this parameter is not specified, then the SW_DR (software data ready) flag</span>
<span class="sd">        of the STATUS register is used to detirmine if the data being reported is new.</span>

<span class="sd">        .. important:: This parameter must be specified if your application is going to use the</span>
<span class="sd">            Pinnacle ASIC&#39;s :attr:`~circuitpython_cirque_pinnacle.DataModes.ANYMEAS`</span>
<span class="sd">            mode (a rather experimental measuring of raw ADC values).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_pin</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dr_pin</span> <span class="o">=</span> <span class="n">dr_pin</span>
        <span class="k">if</span> <span class="n">dr_pin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dr_pin</span><span class="o">.</span><span class="n">switch_to_input</span><span class="p">()</span>

        <span class="c1"># perform hardware check</span>
        <span class="n">firmware_id</span><span class="p">,</span> <span class="n">firmware_ver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rap_read_bytes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">firmware_id</span> <span class="o">!=</span> <span class="mi">7</span> <span class="ow">or</span> <span class="n">firmware_ver</span> <span class="o">!=</span> <span class="mh">0x3A</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">&quot;Cirque Pinnacle ASIC not responding&quot;</span><span class="p">)</span>

        <span class="c1"># init internal attributes w/ factory defaults after power-on-reset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hco</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rap_read</span><span class="p">(</span><span class="mh">0x1F</span><span class="p">))</span>  <span class="c1"># is hardware custom configured?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sys_config</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># ignoring read-only reset flag (bit 0)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feed_config1</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># enables feed &amp; sets to relative mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feed_config2</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># disables taps in relative mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cal_config</span> <span class="o">=</span> <span class="mi">14</span>  <span class="c1"># enables all compensations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sample_rate</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># just a place holder til detect_finger_stylus() call</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_z_idle_count</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_finger_stylus</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># just a place holder til detect_finger_stylus() call</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sensitivity</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># most sensitive ADC gain fro relative/abs mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># 0 means relative mode which is factory default after power-on-reset</span>
        <span class="c1"># init internal buffer used for anymeas_mode_config() using defaults from official example</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anymeas_config</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_flags</span><span class="p">()</span>
        <span class="c1"># write to all internal attributes to registers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detect_finger_stylus</span><span class="p">()</span> <span class="c1"># also writes to FEED_CONFIG3 &amp; SAMPLE_RATE registers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_CALIBRATE_CONFIG</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cal_config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_Z_IDLE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z_idle_count</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write_bytes</span><span class="p">(</span><span class="n">PINNACLE_SYS_CONFIG</span><span class="p">,</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sys_config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feed_config1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feed_config2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_adc_gain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sensitivity</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_flags</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_mode</span> <span class="o">==</span> <span class="n">DataModes</span><span class="o">.</span><span class="n">ANYMEAS</span><span class="p">:</span>
            <span class="c1"># disable tracking computations for AnyMeas mode &amp; power up</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sys_config</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sys_config</span> <span class="o">&amp;</span> <span class="mh">0xE5</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x08</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_SYS_CONFIG</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sys_config</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>  <span class="c1"># wait 10 ms for tracking measurements to expire</span>
            <span class="c1"># dump self._anymeas_config to all 10 registers at once</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write_bytes</span><span class="p">(</span><span class="n">PINNACLE_FEED_CONFIG2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_anymeas_config</span><span class="p">)</span>
            <span class="c1"># clear 8 registers (used for toggle &amp; polarity polynomials)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write_bytes</span><span class="p">(</span><span class="n">PINNACLE_PACKET_BYTE_0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># power up &amp; disable feed to save time/SPI transactions using ERA funcs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_feed_config1</span> <span class="o">&amp;=</span> <span class="mh">0xFE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sys_config</span> <span class="o">&amp;=</span> <span class="mh">0xE5</span>
            <span class="c1"># write to all internal attributes to registers</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write_bytes</span><span class="p">(</span><span class="n">PINNACLE_SYS_CONFIG</span><span class="p">,</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sys_config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feed_config1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feed_config2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_era_write</span><span class="p">(</span><span class="mh">0x0187</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sensitivity</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">detect_finger_stylus</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_finger_stylus</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finger_stylus</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_rate</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_CALIBRATE_CONFIG</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cal_config</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_Z_IDLE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z_idle_count</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feed_enable</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_flags</span><span class="p">()</span> <span class="c1"># just to be sure</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">exc</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shutdown</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">feed_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This `bool` attribute controls if the touch data is reported (`True`) or not</span>
<span class="sd">        (`False`). This attribute does not apply to AnyMeas mode (only Relative &amp; Absolute modes).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_feed_config1</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>

    <span class="nd">@feed_enable</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">feed_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_on</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed_enable</span> <span class="o">!=</span> <span class="n">is_on</span><span class="p">:</span>  <span class="c1"># save ourselves the unnecessary transaction</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_feed_config1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rap_read</span><span class="p">(</span><span class="n">PINNACLE_FEED_CONFIG1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_feed_config1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_feed_config1</span> <span class="o">&amp;</span> <span class="mh">0xFE</span><span class="p">)</span> <span class="o">|</span> <span class="n">is_on</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_FEED_CONFIG1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feed_config1</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This attribute controls which mode the data report is configured for.</span>

<span class="sd">        Valid input values are :attr:`~circuitpython_cirque_pinnacle.DataModes.RELATIVE` for</span>
<span class="sd">        relative/mouse mode, :attr:`~circuitpython_cirque_pinnacle.DataModes.ABSOLUTE` for</span>
<span class="sd">        absolute positioning mode, or :attr:`~circuitpython_cirque_pinnacle.DataModes.ANYMEAS`</span>
<span class="sd">        (referred to as &quot;AnyMeas&quot; in specification sheets) mode for reading ADC values.</span>

<span class="sd">        :Returns:</span>

<span class="sd">            - ``0`` for Relative mode (AKA mouse mode)</span>
<span class="sd">            - ``1`` for AnyMeas mode (raw ADC measurements)</span>
<span class="sd">            - ``2`` for Absolute mode (X &amp; Y axis positions)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span>

    <span class="nd">@data_mode</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">data_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">DataModes</span><span class="o">.</span><span class="n">ANYMEAS</span><span class="p">,</span> <span class="n">DataModes</span><span class="o">.</span><span class="n">RELATIVE</span><span class="p">,</span> <span class="n">DataModes</span><span class="o">.</span><span class="n">ABSOLUTE</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;unrecognised input value for data mode. Use 0 for Relative mode, &quot;</span>
                             <span class="s2">&quot;1 for AnyMeas mode, or 2 for Absolute mode.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">(</span><span class="n">DataModes</span><span class="o">.</span><span class="n">RELATIVE</span><span class="p">,</span> <span class="n">DataModes</span><span class="o">.</span><span class="n">ABSOLUTE</span><span class="p">):</span>  <span class="c1"># for relative/absolute mode</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_mode</span> <span class="o">==</span> <span class="n">DataModes</span><span class="o">.</span><span class="n">ANYMEAS</span><span class="p">:</span>  <span class="c1"># if leaving AnyMeas mode</span>
                <span class="c1"># reload user configuration</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="n">mode</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write_bytes</span><span class="p">(</span><span class="n">PINNACLE_SYS_CONFIG</span><span class="p">,</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_sys_config</span> <span class="o">&amp;</span> <span class="mh">0xE7</span><span class="p">,</span>  <span class="c1"># clear flags specific to AnyMeas mode</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_feed_config1</span> <span class="o">&amp;</span> <span class="mh">0xFD</span><span class="p">)</span> <span class="o">|</span> <span class="n">mode</span><span class="p">,</span>  <span class="c1"># set new mode&#39;s flag</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_feed_config2</span><span class="p">])</span>  <span class="c1"># Relative mode configs</span>
                <span class="c1"># next write to SAMPLE_RATE &amp; FEED_CONFIG3 register</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sample_rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_rate</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_CALIBRATE_CONFIG</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cal_config</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_Z_IDLE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z_idle_count</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># ok to write appropriate mode</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="n">mode</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_feed_config1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_feed_config1</span> <span class="o">&amp;</span> <span class="mh">0xFD</span><span class="p">)</span> <span class="o">|</span> <span class="n">mode</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_FEED_CONFIG1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feed_config1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># for AnyMeas mode</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_pin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># this mode requires the use of DR IRQ pin</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Data Ready digital input (interupt) pin is None, &quot;</span>
                                     <span class="s2">&quot;please specify the dr_pin attribute for AnyMeas mode&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="n">mode</span>  <span class="c1"># allow for anymeas_mode_config() to do something</span>
            <span class="c1"># disable tracking computations for AnyMeas mode</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sys_config</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sys_config</span> <span class="o">&amp;</span> <span class="mh">0xE7</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x08</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_SYS_CONFIG</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sys_config</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>  <span class="c1"># wait 10 ms for tracking measurements to expire</span>
            <span class="c1"># now configure the AnyMeas mode to default values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">anymeas_mode_config</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hard_configured</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This `bool` attribute provides insight to applications about factory</span>
<span class="sd">        customized hardware configuration. see note about product labeling in</span>
<span class="sd">        `Model Labeling Scheme &lt;index.html#cc&gt;`_. (read only)</span>

<span class="sd">        :Returns:</span>
<span class="sd">            `True` if a 470K ohm resistor is populated at the junction labeled &quot;R4&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hco</span>

<div class="viewcode-block" id="PinnacleTouch.relative_mode_config"><a class="viewcode-back" href="../api.html#circuitpython_cirque_pinnacle.PinnacleTouch.relative_mode_config">[docs]</a>    <span class="k">def</span> <span class="nf">relative_mode_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rotate90</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">glide_extend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                             <span class="n">secondary_tap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">taps</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">intellimouse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the configuration register for features specific to relative mode (AKA mouse mode)</span>
<span class="sd">        data reporting.</span>

<span class="sd">        :param bool rotate90: Specifies if the axis data is altered for 90 degree rotation before</span>
<span class="sd">            reporting it (essentially swaps the axis data). Default is `False`.</span>
<span class="sd">        :param bool glide_extend: A patended feature that allows the user to glide their finger off</span>
<span class="sd">            the edge of the sensor and continue gesture with the touch event. Default is `True`.</span>
<span class="sd">            This feature is only available if `hard_configured` is `False`.</span>
<span class="sd">        :param bool secondary_tap: Specifies if tapping in the top-left corner (depending on</span>
<span class="sd">            orientation) triggers the secondary button data. Defaults to `True`. This feature is</span>
<span class="sd">            only available if `hard_configured` is `False`.</span>
<span class="sd">        :param bool taps: Specifies if all taps should be reported (`True`) or not</span>
<span class="sd">            (`False`). Default is `True`. This affects ``secondary_tap`` option as well. The</span>
<span class="sd">            primary button (left mouse button) is emulated with a tap.</span>
<span class="sd">        :param bool intellimouse: Specifies if the data reported includes a byte about scroll data.</span>
<span class="sd">            Default is `False`. Because this flag is specific to scroll data, this feature is only</span>
<span class="sd">            available if `hard_configured` is `False`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feed_config2</span> <span class="o">=</span> <span class="n">rotate90</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span> <span class="o">|</span> <span class="p">(</span><span class="ow">not</span> <span class="n">glide_extend</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span> <span class="o">|</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">secondary_tap</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span> <span class="o">|</span> <span class="p">(</span><span class="ow">not</span> <span class="n">taps</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="n">intellimouse</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_FEED_CONFIG2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feed_config2</span><span class="p">)</span></div>

<div class="viewcode-block" id="PinnacleTouch.absolute_mode_config"><a class="viewcode-back" href="../api.html#circuitpython_cirque_pinnacle.PinnacleTouch.absolute_mode_config">[docs]</a>    <span class="k">def</span> <span class="nf">absolute_mode_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z_idle_count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">invert_x</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">invert_y</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the configuration settings specific to Absolute mode (reports axis positions).</span>
<span class="sd">        (write only)</span>

<span class="sd">        This function only applies to Absolute mode, otherwise if `data_mode` is set to</span>
<span class="sd">        :attr:`~circuitpython_cirque_pinnacle.DataModes.ANYMEAS` or</span>
<span class="sd">        :attr:`~circuitpython_cirque_pinnacle.DataModes.RELATIVE`, then this function will take</span>
<span class="sd">        no affect until `data_mode` is set to</span>
<span class="sd">        :attr:`~circuitpython_cirque_pinnacle.DataModes.ABSOLUTE`.</span>

<span class="sd">        :param int z_idle_count: Specifies the number of empty packets (x-axis, y-axis, and z-axis</span>
<span class="sd">            are ``0``) reported (every 10 milliseconds) when there is no touch detected. Defaults</span>
<span class="sd">            to 30. This number is clamped to range [0, 255].</span>
<span class="sd">        :param bool invert_x: Specifies if the x-axis data is to be inverted before reporting it.</span>
<span class="sd">            Default is `False`.</span>
<span class="sd">        :param bool invert_y: Specifies if the y-axis data is to be inverted before reporting it.</span>
<span class="sd">            Default is `False`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_z_idle_count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">z_idle_count</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_Z_IDLE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z_idle_count</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feed_config1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_feed_config1</span> <span class="o">&amp;</span>
                              <span class="mh">0x3F</span><span class="p">)</span> <span class="o">|</span> <span class="n">invert_y</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span> <span class="o">|</span> <span class="n">invert_x</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_FEED_CONFIG1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feed_config1</span><span class="p">)</span></div>

<div class="viewcode-block" id="PinnacleTouch.report"><a class="viewcode-back" href="../api.html#circuitpython_cirque_pinnacle.PinnacleTouch.report">[docs]</a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">only_new</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function will return touch event data from the Pinnacle ASIC (including empty</span>
<span class="sd">        packets on ending of a touch event). This function only applies to Relative or Absolute</span>
<span class="sd">        mode, otherwise if `data_mode` is set to</span>
<span class="sd">        :attr:`~circuitpython_cirque_pinnacle.DataModes.ANYMEAS`, then this function returns</span>
<span class="sd">        `None` and does nothing.</span>

<span class="sd">        :param bool only_new: This parameter can be used to ensure the data reported is only new</span>
<span class="sd">            data. Otherwise the data returned can be either old data or new data. If the ``dr_pin``</span>
<span class="sd">            parameter is specified upon instantiation, then the specified input pin is used to</span>
<span class="sd">            detect if the data is new. Otherwise the SW_DR flag in the STATUS register is used to</span>
<span class="sd">            detirmine if the data is new.</span>

<span class="sd">        :Returns: `None` if  the ``only_new`` parameter is set `True` and there is no new data to</span>
<span class="sd">            report. Otherwise, a `list` or `bytearray` of parameters that describe the (touch or</span>
<span class="sd">            button) event. The structure is as follows:</span>

<span class="sd">            .. list-table::</span>
<span class="sd">                :header-rows: 1</span>
<span class="sd">                :widths: 1, 5, 5</span>

<span class="sd">                * - Index</span>
<span class="sd">                  - Relative (Mouse) mode</span>

<span class="sd">                    as a `bytearray`</span>
<span class="sd">                  - Absolute Mode</span>

<span class="sd">                    as a `list`</span>
<span class="sd">                * - 0</span>
<span class="sd">                  - Button Data [1]_</span>

<span class="sd">                    one unsigned byte</span>
<span class="sd">                  - Button Data [1]_</span>

<span class="sd">                    one unsigned byte</span>
<span class="sd">                * - 1</span>
<span class="sd">                  - change in x-axis [2]_</span>

<span class="sd">                    -128 |LessEq| X |LessEq| 127</span>
<span class="sd">                  - x-axis Position</span>

<span class="sd">                    128 |LessEq| X |LessEq| 1920</span>
<span class="sd">                * - 2</span>
<span class="sd">                  - change in y-axis [2]_</span>

<span class="sd">                    -128 |LessEq| Y |LessEq| 127</span>
<span class="sd">                  - y-axis Position</span>

<span class="sd">                    64 |LessEq| Y |LessEq| 1472</span>
<span class="sd">                * - 3</span>
<span class="sd">                  - change in scroll wheel</span>

<span class="sd">                    -128 |LessEq| Y |LessEq| 127 [3]_</span>
<span class="sd">                  - z-axis Position</span>

<span class="sd">        .. [1] The returned button data is a byte in which each bit represents a button.</span>
<span class="sd">            The bit to button order is as follows:</span>

<span class="sd">            0. [LSB] Button 1 (thought of as Left button in Relative/Mouse mode). If taps</span>
<span class="sd">               are enabled using `relative_mode_config()`, a single tap will be reflected here.</span>
<span class="sd">            1. Button 2 (thought of as Right button in Relative/Mouse mode)</span>
<span class="sd">            2. Button 3 (thought of as Middle or scroll wheel button in Relative/Mouse mode)</span>
<span class="sd">        .. [2] The axis data reported in Relative/Mouse mode is in two&#39;s</span>
<span class="sd">            comliment form. Use Python&#39;s :py:func:`struct.unpack()` to convert the</span>
<span class="sd">            data into integer form (see `Simple Test example &lt;examples.html#simple-test&gt;`_</span>
<span class="sd">            for how to use this function).</span>

<span class="sd">            The axis data reported in Absolute mode is always positive as the</span>
<span class="sd">            xy-plane&#39;s origin is located to the top-left, unless ``invert_x`` or ``invert_y``</span>
<span class="sd">            parameters to `absolute_mode_config()` are manipulated to change the perspective</span>
<span class="sd">            location of the origin.</span>
<span class="sd">        .. [3] In Relative/Mouse mode the scroll wheel data is only reported if the</span>
<span class="sd">            ``intellimouse`` parameter is passed as `True` to `relative_mode_config()`.</span>
<span class="sd">            Otherwise this is an empty byte as the</span>
<span class="sd">            returned `bytearray` follows the buffer structure of a mouse HID report (see</span>
<span class="sd">            `USB Mouse example &lt;examples.html#usb-mouse-example&gt;`_).</span>
<span class="sd">        .. |LessEq| unicode:: U+2264</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">==</span> <span class="n">DataModes</span><span class="o">.</span><span class="n">ANYMEAS</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">return_vals</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">data_ready</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">only_new</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_pin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data_ready</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rap_read</span><span class="p">(</span><span class="n">PINNACLE_STATUS</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">4</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data_ready</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_pin</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">only_new</span> <span class="ow">and</span> <span class="n">data_ready</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">only_new</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_mode</span> <span class="o">==</span> <span class="n">DataModes</span><span class="o">.</span><span class="n">ABSOLUTE</span><span class="p">:</span>  <span class="c1"># if absolute mode</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rap_read_bytes</span><span class="p">(</span><span class="n">PINNACLE_PACKET_BYTE_0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
                <span class="n">return_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">,</span>  <span class="c1"># buttons</span>
                               <span class="p">((</span><span class="n">temp</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">temp</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>  <span class="c1"># x</span>
                               <span class="p">((</span><span class="n">temp</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xF0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="n">temp</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>  <span class="c1"># y</span>
                               <span class="n">temp</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">]</span>  <span class="c1"># z</span>
                <span class="c1"># datasheet recommends clipping for reliability</span>
                <span class="n">return_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1920</span><span class="p">,</span> <span class="n">return_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">return_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1472</span><span class="p">,</span> <span class="n">return_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_mode</span> <span class="o">==</span> <span class="n">DataModes</span><span class="o">.</span><span class="n">RELATIVE</span><span class="p">:</span>  <span class="c1"># if in relative mode</span>
                <span class="n">is_intellimouse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feed_config2</span> <span class="o">&amp;</span> <span class="mi">1</span>
                <span class="c1"># get relative data packets</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rap_read_bytes</span><span class="p">(</span>
                    <span class="n">PINNACLE_PACKET_BYTE_0</span><span class="p">,</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">is_intellimouse</span><span class="p">)</span>
                <span class="n">return_vals</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">([</span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">,</span> <span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">temp</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
                <span class="k">if</span> <span class="n">is_intellimouse</span><span class="p">:</span>  <span class="c1"># scroll wheel data is captured</span>
                    <span class="n">return_vals</span> <span class="o">+=</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">temp</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># append empty byte to suite mouse HID reports</span>
                    <span class="n">return_vals</span> <span class="o">+=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span>
            <span class="c1"># clear flags despite if data is fresh or not (faster &amp; reliable)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_flags</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">return_vals</span></div>

<div class="viewcode-block" id="PinnacleTouch.clear_flags"><a class="viewcode-back" href="../api.html#circuitpython_cirque_pinnacle.PinnacleTouch.clear_flags">[docs]</a>    <span class="k">def</span> <span class="nf">clear_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function clears the &quot;Data Ready&quot; flag which is reflected with the ``dr_pin``.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="mh">0x02</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># 0x02 = Status1 register</span>
        <span class="c1"># delay 50 microseconds per official example from Cirque</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.00005</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">allow_sleep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set this attribute to `True` if you want the Pinnacle ASIC to enter sleep (low power)</span>
<span class="sd">        mode after about 5 seconds of inactivity (does not apply to AnyMeas mode). While the touch</span>
<span class="sd">        controller is in sleep mode, if a touch event or button press is detected, the Pinnacle</span>
<span class="sd">        ASIC will take about 300 milliseconds to wake up (does not include handling the touch event</span>
<span class="sd">        or button press data).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sys_config</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span>

    <span class="nd">@allow_sleep</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">allow_sleep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_enabled</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sys_config</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sys_config</span> <span class="o">&amp;</span> <span class="mh">0xFB</span><span class="p">)</span> <span class="o">|</span> <span class="n">is_enabled</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_SYS_CONFIG</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sys_config</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This attribute controls power of the Pinnacle ASIC. `True` means powered down (AKA</span>
<span class="sd">        standby mode), and `False` means not powered down (Active, Idle, or Sleep mode).</span>

<span class="sd">        .. note:: The ASIC will take about 300 milliseconds to complete the transition</span>
<span class="sd">            from powered down mode to active mode. No touch events or button presses will be</span>
<span class="sd">            monitored while powered down.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sys_config</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span>

    <span class="nd">@shutdown</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_off</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sys_config</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sys_config</span> <span class="o">&amp;</span> <span class="mh">0xFD</span><span class="p">)</span> <span class="o">|</span> <span class="n">is_off</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_SYS_CONFIG</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sys_config</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sample_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This attribute controls how many samples (of data) per second are reported. Valid values</span>
<span class="sd">        are ``100``, ``80``, ``60``, ``40``, ``20``, ``10``. Any other input values automatically</span>
<span class="sd">        set the sample rate to 100 sps (samples per second). Optionally, ``200`` and ``300`` sps</span>
<span class="sd">        can be specified, but using these values automatically disables palm (referred to as &quot;NERD&quot;</span>
<span class="sd">        in the specification sheet) and noise compensations. These higher values are meant for</span>
<span class="sd">        using a stylus with a 2mm diameter tip, while the values less than 200 are meant for a</span>
<span class="sd">        finger or stylus with a 5.25mm diameter tip.</span>

<span class="sd">        This function only applies to Relative or Absolute mode, otherwise if `data_mode` is set to</span>
<span class="sd">        :attr:`~circuitpython_cirque_pinnacle.DataModes.ANYMEAS`, then this function will take no</span>
<span class="sd">        affect until `data_mode` is set to</span>
<span class="sd">        :attr:`~circuitpython_cirque_pinnacle.DataModes.RELATIVE` or</span>
<span class="sd">        :attr:`~circuitpython_cirque_pinnacle.DataModes.ABSOLUTE`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_rate</span>

    <span class="nd">@sample_rate</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">sample_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">):</span>
            <span class="c1"># disable palm &amp; noise compensations</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_FEED_CONFIG2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">reload_timer</span> <span class="o">=</span> <span class="mi">6</span> <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">300</span> <span class="k">else</span> <span class="mh">0x09</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_era_write_bytes</span><span class="p">(</span><span class="mh">0x019E</span><span class="p">,</span> <span class="n">reload_timer</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sample_rate</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># enable palm &amp; noise compensations</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_FEED_CONFIG2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_era_write_bytes</span><span class="p">(</span><span class="mh">0x019E</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">val</span> <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="k">else</span> <span class="mi">100</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sample_rate</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_mode</span> <span class="o">!=</span> <span class="n">DataModes</span><span class="o">.</span><span class="n">ANYMEAS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_SAMPLE_RATE</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

<div class="viewcode-block" id="PinnacleTouch.detect_finger_stylus"><a class="viewcode-back" href="../api.html#circuitpython_cirque_pinnacle.PinnacleTouch.detect_finger_stylus">[docs]</a>    <span class="k">def</span> <span class="nf">detect_finger_stylus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable_finger</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">enable_stylus</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sample_rate</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function will configure the Pinnacle ASIC to detect either finger,</span>
<span class="sd">        stylus, or both.</span>

<span class="sd">        :param bool enable_finger: `True` enables the Pinnacle ASIC&#39;s measurements to</span>
<span class="sd">            detect if the touch event was caused by a finger or 5.25mm stylus. `False` disables</span>
<span class="sd">            this feature. Default is `True`.</span>
<span class="sd">        :param bool enable_stylus: `True` enables the Pinnacle ASIC&#39;s measurements to</span>
<span class="sd">            detect if the touch event was caused by a 2mm stylus. `False` disables this</span>
<span class="sd">            feature. Default is `True`.</span>
<span class="sd">        :param int sample_rate: See the `sample_rate` attribute as this parameter manipulates that</span>
<span class="sd">            attribute.</span>

<span class="sd">        .. tip:: Consider adjusting the ADC matrix&#39;s gain to enhance performance/results using</span>
<span class="sd">            `set_adc_gain()`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_finger_stylus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_era_read</span><span class="p">(</span><span class="mh">0x00EB</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_finger_stylus</span> <span class="o">|=</span> <span class="n">enable_stylus</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span> <span class="o">|</span> <span class="n">enable_finger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_era_write</span><span class="p">(</span><span class="mh">0x00EB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finger_stylus</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample_rate</span> <span class="o">=</span> <span class="n">sample_rate</span></div>

<div class="viewcode-block" id="PinnacleTouch.calibrate"><a class="viewcode-back" href="../api.html#circuitpython_cirque_pinnacle.PinnacleTouch.calibrate">[docs]</a>    <span class="k">def</span> <span class="nf">calibrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="n">tap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track_error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nerd</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set calibration parameters when the Pinnacle ASIC calibrates itself. This function only</span>
<span class="sd">        applies to Relative or Absolute mode, otherwise if `data_mode` is set to</span>
<span class="sd">        :attr:`~circuitpython_cirque_pinnacle.DataModes.ANYMEAS`, then this function will take no</span>
<span class="sd">        affect until `data_mode` is set to</span>
<span class="sd">        :attr:`~circuitpython_cirque_pinnacle.DataModes.RELATIVE` or</span>
<span class="sd">        :attr:`~circuitpython_cirque_pinnacle.DataModes.ABSOLUTE`.</span>

<span class="sd">        :param bool run: If `True`, this function forces a calibration of the sensor. If `False`,</span>
<span class="sd">            this function just writes the following parameters to the Pinnacle ASIC&#39;s &quot;CalConfig1&quot;</span>
<span class="sd">            register. This parameter is required while the rest are optional keyword parameters.</span>
<span class="sd">        :param bool tap: Enable dynamic tap compensation? Default is `True`.</span>
<span class="sd">        :param bool track_error: Enable dynamic track error compensation? Default is `True`.</span>
<span class="sd">        :param bool nerd: Enable dynamic NERD compensation? Default is `True`. This parameter has</span>
<span class="sd">            something to do with palm detection/compensation.</span>
<span class="sd">        :param bool background: Enable dynamic background compensation? Default is `True`.</span>

<span class="sd">        .. note:: According to the datasheet, calibration of the sensor takes about 100</span>
<span class="sd">            milliseconds. This function will block until calibration is complete (if ``run`` is</span>
<span class="sd">            `True`). It is recommended for typical applications to leave all optional parameters</span>
<span class="sd">            in their default states.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cal_config</span> <span class="o">=</span> <span class="n">tap</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span> <span class="o">|</span> <span class="n">track_error</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span> <span class="o">|</span> <span class="n">nerd</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span> <span class="o">|</span> <span class="n">background</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_mode</span> <span class="o">!=</span> <span class="n">DataModes</span><span class="o">.</span><span class="n">ANYMEAS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_CALIBRATE_CONFIG</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cal_config</span> <span class="o">|</span> <span class="n">run</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">run</span><span class="p">:</span>
                <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rap_read</span><span class="p">(</span><span class="n">PINNACLE_CALIBRATE_CONFIG</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">pass</span>  <span class="c1"># calibration is running</span>
                <span class="c1"># now that calibration is done, clear &quot;command complete&quot; flag</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clear_flags</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">calibration_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This attribute returns a `list` of the 46 signed 16-bit (short) values stored in the</span>
<span class="sd">        Pinnacle ASIC&#39;s memory that is used for taking measurements. This matrix is not applicable</span>
<span class="sd">        in AnyMeas mode. Use this attribute to compare a prior compensation matrix with a new</span>
<span class="sd">        matrix that was either loaded manually by setting this attribute to a `list` of 46 signed</span>
<span class="sd">        16-bit (short) integers or created internally by calling `calibrate()` with the ``run``</span>
<span class="sd">        parameter as `True`.</span>

<span class="sd">        .. note:: A paraphrased note from Cirque&#39;s Application Note on Comparing compensation</span>
<span class="sd">            matrices:</span>

<span class="sd">            If any 16-bit values are above 20K (absolute), it generally indicates a problem with</span>
<span class="sd">            the sensor. If no values exceed 20K, proceed with the data comparison. Compare each</span>
<span class="sd">            16-bit value in one matrix to the corresponding 16-bit value in the other matrix. If</span>
<span class="sd">            the difference between the two values is greater than 500 (absolute), it indicates a</span>
<span class="sd">            change in the environment. Either an object was on the sensor during calibration, or</span>
<span class="sd">            the surrounding conditions (temperature, humidity, or noise level) have changed. One</span>
<span class="sd">            strategy is to force another calibration and compare again, if the values continue to</span>
<span class="sd">            differ by 500, determine whether to use the new data or a previous set of stored data.</span>
<span class="sd">            Another strategy is to average any two values that differ by more than 500 and write</span>
<span class="sd">            this new matrix, with the average values, back into Pinnacle ASIC.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># combine every 2 bytes from resulting buffer to form a list of signed 16-bits integers</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;46h&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_era_read_bytes</span><span class="p">(</span><span class="mh">0x01DF</span><span class="p">,</span> <span class="mi">46</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)))</span>


    <span class="nd">@calibration_matrix</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">calibration_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrix</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">46</span><span class="p">:</span>  <span class="c1"># padd short matrices w/ 0s</span>
            <span class="n">matrix</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">46</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">matrix</span><span class="p">))</span>
        <span class="c1"># save time on bus interactions by pausing feed now</span>
        <span class="n">prev_feed_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed_enable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feed_enable</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># required for ERA functions anyway</span>
        <span class="c1"># be sure to not write more than allowed</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">46</span><span class="p">):</span>
            <span class="c1"># write 2 bytes at a time</span>
            <span class="n">buf</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">matrix</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_era_write</span><span class="p">(</span><span class="mh">0x01DF</span> <span class="o">+</span> <span class="n">index</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_era_write</span><span class="p">(</span><span class="mh">0x01DF</span> <span class="o">+</span> <span class="n">index</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feed_enable</span> <span class="o">=</span> <span class="n">prev_feed_state</span>  <span class="c1"># resume previous feed state</span>

<div class="viewcode-block" id="PinnacleTouch.set_adc_gain"><a class="viewcode-back" href="../api.html#circuitpython_cirque_pinnacle.PinnacleTouch.set_adc_gain">[docs]</a>    <span class="k">def</span> <span class="nf">set_adc_gain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sensitivity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the ADC gain in range [0,3] to enhance performance based on the overlay type (does</span>
<span class="sd">        not apply to AnyMeas mode). (write-only)</span>

<span class="sd">        :param int sensitivity: This int specifies how sensitive the ADC (Analog to Digital</span>
<span class="sd">            Converter) component is. ``0`` means most sensitive, and ``3`` means least sensitive.</span>
<span class="sd">            A value outside this range will raise a `ValueError` exception.</span>

<span class="sd">        .. tip:: The official example code from Cirque for a curved overlay uses a value of ``1``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">sensitivity</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sensitivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_era_read</span><span class="p">(</span><span class="mh">0x0187</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3F</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sensitivity</span> <span class="o">|=</span> <span class="n">sensitivity</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_era_write</span><span class="p">(</span><span class="mh">0x0187</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sensitivity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is out of bounds [0,3]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sensitivity</span><span class="p">))</span></div>

<div class="viewcode-block" id="PinnacleTouch.tune_edge_sensitivity"><a class="viewcode-back" href="../api.html#circuitpython_cirque_pinnacle.PinnacleTouch.tune_edge_sensitivity">[docs]</a>    <span class="k">def</span> <span class="nf">tune_edge_sensitivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_axis_wide_z_min</span><span class="o">=</span><span class="mh">0x04</span><span class="p">,</span> <span class="n">y_axis_wide_z_min</span><span class="o">=</span><span class="mh">0x03</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;According to the official exmaple code from Cirque,</span>
<span class="sd">        this function &quot;Changes thresholds to improve detection of fingers.&quot;</span>

<span class="sd">        This function was ported from Cirque&#39;s example code and doesn&#39;t seem to have corresponding</span>
<span class="sd">        documentation. I&#39;m having trouble finding a memory map of the Pinnacle ASIC as this</span>
<span class="sd">        function directly alters values in the Pinnacle ASIC&#39;s memory. USE AT YOUR OWN RISK!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_era_write</span><span class="p">(</span><span class="mh">0x0149</span><span class="p">,</span> <span class="n">x_axis_wide_z_min</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_era_write</span><span class="p">(</span><span class="mh">0x0168</span><span class="p">,</span> <span class="n">y_axis_wide_z_min</span><span class="p">)</span></div>

<div class="viewcode-block" id="PinnacleTouch.anymeas_mode_config"><a class="viewcode-back" href="../api.html#circuitpython_cirque_pinnacle.PinnacleTouch.anymeas_mode_config">[docs]</a>    <span class="k">def</span> <span class="nf">anymeas_mode_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gain</span><span class="o">=</span><span class="n">AnyMeasGain</span><span class="o">.</span><span class="n">GAIN_200</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="n">AnyMeasFreq</span><span class="o">.</span><span class="n">FREQ_0</span><span class="p">,</span>
                            <span class="n">sample_length</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">mux_ctrl</span><span class="o">=</span><span class="n">AnyMeasMux</span><span class="o">.</span><span class="n">MUX_PNP</span><span class="p">,</span> <span class="n">apperture_width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
                            <span class="n">ctrl_pwr_cnt</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function configures the Pinnacle ASIC to output raw ADC measurements.</span>
<span class="sd">        Be sure to set the `data_mode` attribute to</span>
<span class="sd">        :attr:`~circuitpython_cirque_pinnacle.DataModes.ANYMEAS` before calling this function</span>
<span class="sd">        otherwise it will do nothing.</span>

<span class="sd">        :param int gain: Sets the sensitivity of the ADC matrix. Valid values are the constants</span>
<span class="sd">            defined in :class:`~circuitpython_cirque_pinnacle.AnyMeasGain`. Defaults to</span>
<span class="sd">            :attr:`~circuitpython_cirque_pinnacle.AnyMeasGain.GAIN_200`.</span>
<span class="sd">        :param int frequency: Sets the frequency of measurements made by the ADC matrix. Valid</span>
<span class="sd">            values are the constants defined in</span>
<span class="sd">            :class:`~circuitpython_cirque_pinnacle.AnyMeasFreq`.</span>
<span class="sd">            Defaults :attr:`~circuitpython_cirque_pinnacle.AnyMeasFreq.FREQ_0`.</span>
<span class="sd">        :param int sample_length: Sets the maximum bit length of the measurements made by the ADC</span>
<span class="sd">            matrix. Valid values are ``128``, ``256``, or ``512``. Defaults to ``512``.</span>
<span class="sd">        :param int mux_ctrl: The Pinnacle ASIC can employ different bipolar junctions</span>
<span class="sd">            and/or reference capacitors. Valid values are the constants defined in</span>
<span class="sd">            :class:`~circuitpython_cirque_pinnacle.AnyMeasMux`. Additional combination of</span>
<span class="sd">            these constants is also allowed. Defaults to</span>
<span class="sd">            :attr:`~circuitpython_cirque_pinnacle.AnyMeasMux.MUX_PNP`.</span>
<span class="sd">        :param int apperture_width: Sets the window of time (in nanoseconds) to allow for the ADC</span>
<span class="sd">            to take a measurement. Valid values are multiples of 125 in range [``250``, ``1875``].</span>
<span class="sd">            Erroneous values are clamped/truncated to this range.</span>

<span class="sd">            .. note:: The ``apperture_width`` parameter has a inverse relationship/affect on the</span>
<span class="sd">                ``frequency`` parameter. The approximated frequencies described in this</span>
<span class="sd">                documentation are based on an aperture width of 500 nanoseconds, and they will</span>
<span class="sd">                shrink as the apperture width grows or grow as the aperture width shrinks.</span>

<span class="sd">        :param int ctrl_pwr_cnt: Configure the Pinnacle to perform a number of measurements for</span>
<span class="sd">            each call to `measure_adc()`. Defaults to 1. Constants defined in</span>
<span class="sd">            :class:`~circuitpython_cirque_pinnacle.AnyMeasCrtl` can be used to specify if is sleep</span>
<span class="sd">            is allowed (:attr:`~circuitpython_cirque_pinnacle.AnyMeasCrtl.CRTL_PWR_IDLE` -- this</span>
<span class="sd">            is not default) or if repetive measurements is allowed (</span>
<span class="sd">            :attr:`~circuitpython_cirque_pinnacle.AnyMeasCrtl.CRTL_REPEAT`) if number of</span>
<span class="sd">            measurements is more than 1.</span>

<span class="sd">            .. warning:: There is no bounds checking on the number of measurements specified</span>
<span class="sd">                here. Specifying more than 63 will trigger sleep mode after performing</span>
<span class="sd">                measuements.</span>

<span class="sd">            .. tip:: Be aware that allowing the Pinnacle to enter sleep mode after taking</span>
<span class="sd">                measurements will slow consecutive calls to `measure_adc()` as the Pinnacle</span>
<span class="sd">                requires about 100 milliseconds to wake up.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_mode</span> <span class="o">==</span> <span class="n">DataModes</span><span class="o">.</span><span class="n">ANYMEAS</span><span class="p">:</span>
            <span class="c1"># assemble buffer for configuring ADC measurements</span>
            <span class="c1"># approximate frequency and gain config</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_anymeas_config</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">gain</span> <span class="o">|</span> <span class="n">frequency</span>
            <span class="c1"># sample length must be in range [1, 3]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_anymeas_config</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sample_length</span> <span class="o">/</span> <span class="mi">128</span><span class="p">),</span> <span class="mi">3</span><span class="p">)))</span>
            <span class="c1"># enable ADC gate polarity</span>
            <span class="c1"># (PNP can be combined w/ NPN or only NPN or only PNP)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_anymeas_config</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">mux_ctrl</span>
            <span class="c1"># next is ADCconfig2 reg (mostly internal firmware flags)</span>
            <span class="c1"># self._anymeas_config[3] = 0</span>
            <span class="c1"># apperture widths 125 or less don&#39;t work; default to 250 if 125 or less is specified</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_anymeas_config</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">apperture_width</span> <span class="o">/</span> <span class="mi">125</span><span class="p">),</span> <span class="mi">15</span><span class="p">))</span>
            <span class="c1"># self._anymeas_config.[5, 7, 8] = 0 these are &quot;test-only&quot; registers</span>
            <span class="c1"># specify the register to use as offset for measurement polynomials</span>
            <span class="c1"># self._anymeas_config[6] = PINNACLE_PACKET_BYTE_0 + 1  # use 0x13</span>
            <span class="c1"># next is the power and count control register</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_anymeas_config</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">ctrl_pwr_cnt</span>
            <span class="c1"># dump self._anymeas_config to all 10 registers at once</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write_bytes</span><span class="p">(</span><span class="n">PINNACLE_FEED_CONFIG2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_anymeas_config</span><span class="p">)</span>
            <span class="c1"># clear 8 registers (used for toggle &amp; polarity polynomials)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write_bytes</span><span class="p">(</span><span class="n">PINNACLE_PACKET_BYTE_0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_flags</span><span class="p">()</span></div>

<div class="viewcode-block" id="PinnacleTouch.measure_adc"><a class="viewcode-back" href="../api.html#circuitpython_cirque_pinnacle.PinnacleTouch.measure_adc">[docs]</a>    <span class="k">def</span> <span class="nf">measure_adc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bits_to_toggle</span><span class="p">,</span> <span class="n">toggle_polarity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function instigates and returns the measurements (a signed short) from the Pinnacle</span>
<span class="sd">        ASIC&#39;s ADC (Analog to Digital Converter) matrix (only applies to AnyMeas mode).</span>

<span class="sd">        :param int bits_to_toggle: This 4-byte integer specifies which bits the Pinnacle touch</span>
<span class="sd">            controller should toggle. A bit of ``1`` flags that bit for toggling, and a bit of</span>
<span class="sd">            ``0`` signifies that the bit should remain unaffected.</span>
<span class="sd">        :param int toggle_polarity: This 4-byte integer specifies which polarity the specified</span>
<span class="sd">            bits (from ``bits_to_toggle`` parameter) are toggled. A bit of ``1`` toggles that bit</span>
<span class="sd">            positve, and a bit of ``0`` toggles that bit negative.</span>

<span class="sd">        :Returns:</span>
<span class="sd">            A 2-byte `bytearray` that represents a signed short integer. If `data_mode` is not set</span>
<span class="sd">            to :attr:`~circuitpython_cirque_pinnacle.DataModes.ANYMEAS`, then this function returns</span>
<span class="sd">            `None` and does nothing.</span>

<span class="sd">        :4-byte Integer Format:</span>
<span class="sd">            .. csv-table:: byte 3 (MSByte)</span>
<span class="sd">                :stub-columns: 1</span>
<span class="sd">                :widths: 10, 5, 5, 5, 5, 5, 5, 5, 5</span>

<span class="sd">                &quot;bit position&quot;,31,30,29,28,27,26,25,24</span>
<span class="sd">                &quot;representation&quot;,N/A,N/A,Ref1,Ref0,Y11,Y10,Y9,Y8</span>
<span class="sd">            .. csv-table:: byte 2</span>
<span class="sd">                :stub-columns: 1</span>
<span class="sd">                :widths: 10, 5, 5, 5, 5, 5, 5, 5, 5</span>

<span class="sd">                &quot;bit position&quot;,23,22,21,20,19,18,17,16</span>
<span class="sd">                &quot;representation&quot;,Y7,Y6,Y5,Y4,Y3,Y2,Y1,Y0</span>
<span class="sd">            .. csv-table:: byte 1</span>
<span class="sd">                :stub-columns: 1</span>
<span class="sd">                :widths: 10, 5, 5, 5, 5, 5, 5, 5, 5</span>

<span class="sd">                &quot;bit position&quot;,15,14,13,12,11,10,9,8</span>
<span class="sd">                &quot;representation&quot;,X15,X14,X13,X12,X11,X10,X9,X8</span>
<span class="sd">            .. csv-table:: byte 0 (LSByte)</span>
<span class="sd">                :stub-columns: 1</span>
<span class="sd">                :widths: 10, 5, 5, 5, 5, 5, 5, 5, 5</span>

<span class="sd">                &quot;bit position&quot;,7,6,5,4,3,2,1,0</span>
<span class="sd">                &quot;representation&quot;,X7,X6,X5,X4,X3,X2,X1,X0</span>

<span class="sd">            See `AnyMeas mode example &lt;examples.html#anymeas-mode-example&gt;`_ to understand how to</span>
<span class="sd">            use these 4-byte integer polynomials.</span>

<span class="sd">            .. note:: Bits 29 and 28 represent the optional implementation of reference capacitors</span>
<span class="sd">                built into the Pinnacle ASIC. To use these capacitors, the</span>
<span class="sd">                corresponding constants</span>
<span class="sd">                (:attr:`~circuitpython_cirque_pinnacle.AnyMeasMux.MUX_REF0` and/or</span>
<span class="sd">                :attr:`~circuitpython_cirque_pinnacle.AnyMeasMux.MUX_REF1`) must be passed to</span>
<span class="sd">                `anymeas_mode_config()` in the ``mux_ctrl`` parameter, and their representative</span>
<span class="sd">                bits must be flagged in both ``bits_to_toggle`` &amp; ``toggle_polarity`` parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># assemble list of register buffers</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">!=</span> <span class="n">DataModes</span><span class="o">.</span><span class="n">ANYMEAS</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">tog_pol</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">tog_pol</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">bits_to_toggle</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">8</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">tog_pol</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">toggle_polarity</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">8</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span>
        <span class="c1"># write toggle and polarity parameters to register 0x13 - 0x1A (PACKET_BYTE_1 + 8)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write_bytes</span><span class="p">(</span><span class="n">PINNACLE_PACKET_BYTE_0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tog_pol</span><span class="p">)</span>

        <span class="c1"># initiate measurements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_SYS_CONFIG</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sys_config</span> <span class="o">|</span> <span class="mh">0x18</span><span class="p">)</span>
        <span class="c1"># wait till measurements are complete</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_pin</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># Pinnacle is still computing</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rap_read_bytes</span><span class="p">(</span><span class="n">PINNACLE_PACKET_BYTE_0</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_flags</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_rap_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function is overridden by the appropriate parent class based on interface type.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_rap_read_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">numb_bytes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function is overridden by the appropriate parent class based on interface type.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_rap_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function is overridden by the appropriate parent class based on interface type.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_rap_write_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function is overridden by the appropriate parent class based on interface type.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_era_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reg</span><span class="p">):</span>
        <span class="n">prev_feed_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed_enable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feed_enable</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># accessing raw memory, so do this</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write_bytes</span><span class="p">(</span><span class="n">PINNACLE_ERA_ADDR_HIGH</span><span class="p">,</span> <span class="p">[</span><span class="n">reg</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">,</span> <span class="n">reg</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_ERA_CTRL</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># indicate reading only 1 byte</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rap_read</span><span class="p">(</span><span class="n">PINNACLE_ERA_CTRL</span><span class="p">):</span>  <span class="c1"># read until reg == 0</span>
            <span class="k">pass</span>  <span class="c1"># also sets Command Complete flag in Status register</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rap_read</span><span class="p">(</span><span class="n">PINNACLE_ERA_VALUE</span><span class="p">)</span>  <span class="c1"># get value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_flags</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feed_enable</span> <span class="o">=</span> <span class="n">prev_feed_state</span>  <span class="c1"># resume previous feed state</span>
        <span class="k">return</span> <span class="n">buf</span>

    <span class="k">def</span> <span class="nf">_era_read_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">numb_bytes</span><span class="p">):</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
        <span class="n">prev_feed_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed_enable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feed_enable</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># accessing raw memory, so do this</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write_bytes</span><span class="p">(</span><span class="n">PINNACLE_ERA_ADDR_HIGH</span><span class="p">,</span> <span class="p">[</span><span class="n">reg</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">,</span> <span class="n">reg</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numb_bytes</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_ERA_CTRL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># indicate reading sequential bytes</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rap_read</span><span class="p">(</span><span class="n">PINNACLE_ERA_CTRL</span><span class="p">):</span>  <span class="c1"># read until reg == 0</span>
                <span class="k">pass</span>  <span class="c1"># also sets Command Complete flag in Status register</span>
            <span class="n">buf</span> <span class="o">+=</span> <span class="nb">bytes</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_rap_read</span><span class="p">(</span><span class="n">PINNACLE_ERA_VALUE</span><span class="p">)])</span>  <span class="c1"># get value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_flags</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feed_enable</span> <span class="o">=</span> <span class="n">prev_feed_state</span>  <span class="c1"># resume previous feed state</span>
        <span class="k">return</span> <span class="n">buf</span>

    <span class="k">def</span> <span class="nf">_era_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">prev_feed_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed_enable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feed_enable</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># accessing raw memory, so do this</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_ERA_VALUE</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>  <span class="c1"># write value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write_bytes</span><span class="p">(</span><span class="n">PINNACLE_ERA_ADDR_HIGH</span><span class="p">,</span> <span class="p">[</span><span class="n">reg</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">,</span> <span class="n">reg</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_ERA_CTRL</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># indicate writing only 1 byte</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rap_read</span><span class="p">(</span><span class="n">PINNACLE_ERA_CTRL</span><span class="p">):</span>  <span class="c1"># read until reg == 0</span>
            <span class="k">pass</span>  <span class="c1"># also sets Command Complete flag in Status register</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_flags</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feed_enable</span> <span class="o">=</span> <span class="n">prev_feed_state</span>  <span class="c1"># resume previous feed state</span>

    <span class="k">def</span> <span class="nf">_era_write_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">numb_bytes</span><span class="p">):</span>
        <span class="c1"># NOTE this is rarely used as it only writes 1 value to multiple registers</span>
        <span class="n">prev_feed_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed_enable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feed_enable</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># accessing raw memory, so do this</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_ERA_VALUE</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>  <span class="c1"># write value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write_bytes</span><span class="p">(</span><span class="n">PINNACLE_ERA_ADDR_HIGH</span><span class="p">,</span> <span class="p">[</span><span class="n">reg</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">,</span> <span class="n">reg</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">PINNACLE_ERA_CTRL</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">)</span>  <span class="c1"># indicate writing sequential bytes</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numb_bytes</span><span class="p">):</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rap_read</span><span class="p">(</span><span class="n">PINNACLE_ERA_CTRL</span><span class="p">):</span>  <span class="c1"># read until reg == 0</span>
                <span class="k">pass</span>  <span class="c1"># also sets Command Complete flag in Status register</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_flags</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feed_enable</span> <span class="o">=</span> <span class="n">prev_feed_state</span>  <span class="c1"># resume previous feed state</span></div>

<span class="c1"># due to use adafruit_bus_device, pylint can&#39;t find bus-specific functions</span>
<span class="c1"># pylint: disable=no-member</span>
<div class="viewcode-block" id="PinnacleTouchI2C"><a class="viewcode-back" href="../api.html#circuitpython_cirque_pinnacle.PinnacleTouchI2C">[docs]</a><span class="k">class</span> <span class="nc">PinnacleTouchI2C</span><span class="p">(</span><span class="n">PinnacleTouch</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Varaiant of the base class, `PinnacleTouch`, for interfacing with the Pinnacle ASIC via</span>
<span class="sd">    the I2C protocol.</span>

<span class="sd">    :param ~busio.I2C i2c: The object of the I2C bus to use. This object must be shared among</span>
<span class="sd">        other driver classes that use the same I2C bus (SDA &amp; SCL pins).</span>
<span class="sd">    :param int address: The slave I2C address of the Pinnacle ASIC. Defaults to ``0x2A``.</span>

<span class="sd">    See the base class for other instantiating parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i2c</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="mh">0x2A</span><span class="p">,</span> <span class="n">dr_pin</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_i2c</span> <span class="o">=</span> <span class="n">I2CDevice</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span> <span class="p">(</span><span class="n">address</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># per datasheet</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PinnacleTouchI2C</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">dr_pin</span><span class="o">=</span><span class="n">dr_pin</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rap_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reg</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rap_read_bytes</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rap_read_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">numb_bytes</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_i2c</span><span class="o">.</span><span class="n">device_address</span> <span class="o">&amp;=</span> <span class="mh">0xFE</span>  <span class="c1"># set write flag</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">([</span><span class="n">reg</span> <span class="o">|</span> <span class="mh">0xA0</span><span class="p">])</span>  <span class="c1"># per datasheet</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_i2c</span> <span class="k">as</span> <span class="n">i2c</span><span class="p">:</span>
            <span class="n">i2c</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>  <span class="c1"># includes a STOP condition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_i2c</span><span class="o">.</span><span class="n">device_address</span> <span class="o">|=</span> <span class="mi">1</span>  <span class="c1"># set read flag</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">numb_bytes</span><span class="p">)</span>  <span class="c1"># for accumulating response(s)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_i2c</span> <span class="k">as</span> <span class="n">i2c</span><span class="p">:</span>
            <span class="c1"># auto-increments register for each byte read</span>
            <span class="n">i2c</span><span class="o">.</span><span class="n">readinto</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">buf</span>

    <span class="k">def</span> <span class="nf">_rap_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write_bytes</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="p">[</span><span class="n">value</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_rap_write_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_i2c</span><span class="o">.</span><span class="n">device_address</span> <span class="o">&amp;=</span> <span class="mh">0xFE</span>  <span class="c1"># set write flag</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">byte</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>  <span class="c1"># works for bytearrays/lists/tuples</span>
            <span class="c1"># Pinnacle doesn&#39;t auto-increment register addresses for I2C write operations</span>
            <span class="c1"># Also truncate int elements of a list/tuple</span>
            <span class="n">buf</span> <span class="o">+=</span> <span class="nb">bytearray</span><span class="p">([(</span><span class="n">reg</span> <span class="o">+</span> <span class="n">index</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x80</span><span class="p">,</span> <span class="n">byte</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">])</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_i2c</span> <span class="k">as</span> <span class="n">i2c</span><span class="p">:</span>
            <span class="n">i2c</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span></div>

<div class="viewcode-block" id="PinnacleTouchSPI"><a class="viewcode-back" href="../api.html#circuitpython_cirque_pinnacle.PinnacleTouchSPI">[docs]</a><span class="k">class</span> <span class="nc">PinnacleTouchSPI</span><span class="p">(</span><span class="n">PinnacleTouch</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Varaiant of the base class, `PinnacleTouch`, for interfacing with the Pinnacle ASIC via</span>
<span class="sd">    the SPI protocol.</span>

<span class="sd">    :param ~busio.SPI spi: The object of the SPI bus to use. This object must be shared among</span>
<span class="sd">        other driver classes that use the same SPI bus (MOSI, MISO, &amp; SCK pins).</span>
<span class="sd">    :param ~microcontroller.Pin ss_pin: The &quot;slave select&quot; pin output to the Pinnacle ASIC.</span>

<span class="sd">    See the base class for other instantiating parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spi</span><span class="p">,</span> <span class="n">ss_pin</span><span class="p">,</span> <span class="n">dr_pin</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># MAX baudrate is up to 13MHz; use 10MHz to be safe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spi</span> <span class="o">=</span> <span class="n">SPIDevice</span><span class="p">(</span><span class="n">spi</span><span class="p">,</span> <span class="n">chip_select</span><span class="o">=</span><span class="n">ss_pin</span><span class="p">,</span>
                              <span class="n">baudrate</span><span class="o">=</span><span class="mi">12000000</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PinnacleTouchSPI</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">dr_pin</span><span class="o">=</span><span class="n">dr_pin</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rap_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reg</span><span class="p">):</span>
        <span class="n">buf_out</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">([</span><span class="n">reg</span> <span class="o">|</span> <span class="mh">0xA0</span><span class="p">])</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xFB</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="mi">3</span>
        <span class="n">buf_in</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">buf_out</span><span class="p">))</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spi</span> <span class="k">as</span> <span class="n">spi</span><span class="p">:</span>
            <span class="n">spi</span><span class="o">.</span><span class="n">write_readinto</span><span class="p">(</span><span class="n">buf_out</span><span class="p">,</span> <span class="n">buf_in</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">buf_in</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_rap_read_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">numb_bytes</span><span class="p">):</span>
        <span class="c1"># using auto-increment method</span>
        <span class="n">buf_out</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">([</span><span class="n">reg</span> <span class="o">|</span> <span class="mh">0xA0</span><span class="p">])</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xFC</span><span class="s1">&#39;</span> <span class="o">*</span> \
            <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">numb_bytes</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xFB</span><span class="s1">&#39;</span>
        <span class="n">buf_in</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">buf_out</span><span class="p">))</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spi</span> <span class="k">as</span> <span class="n">spi</span><span class="p">:</span>
            <span class="n">spi</span><span class="o">.</span><span class="n">write_readinto</span><span class="p">(</span><span class="n">buf_out</span><span class="p">,</span> <span class="n">buf_in</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">buf_in</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>

    <span class="k">def</span> <span class="nf">_rap_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">([(</span><span class="n">reg</span> <span class="o">|</span> <span class="mh">0x80</span><span class="p">),</span> <span class="n">value</span><span class="p">])</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spi</span> <span class="k">as</span> <span class="n">spi</span><span class="p">:</span>
            <span class="n">spi</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rap_write_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rap_write</span><span class="p">(</span><span class="n">reg</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020 Brendan Doherty

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>